<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>streamblast</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: rgb(3,4,6);
            background: radial-gradient(circle, rgba(3,4,6,1) 0%, rgba(27,7,46,1) 100%);
            color: #ffffff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            font-weight: 600;
            font-size: 48px;
            text-align: center;
            margin-bottom: 10px;
            color: #ffffff;
        }
        .slogan {
            font-weight: 400;
            font-size: 18px;
            text-align: center;
            margin-bottom: 30px;
            color: #ffffff;
        }
        #search-form {
            display: flex;
            margin-bottom: 20px;
        }
        #search-input {
            flex-grow: 1;
            padding: 10px;
            font-size: 16px;
            border: none;
            border-radius: 5px 0 0 5px;
            background-color: #2a2a3a;
            color: #ffffff;
        }
        #search-button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 0 5px 5px 0;
            background-color: #4da8da;
            color: #ffffff;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #search-button:hover {
            background-color: #3a8bb8;
        }
        #results, #trending-movies, #trending-series {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        .movie-card {
            background: linear-gradient(to bottom, #1a1a2e, #16213e);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s, opacity 0.3s;
            cursor: pointer;
            opacity: 1; /* Set to 1 initially */
            transform: translateY(0); /* Set to default transform */
        }
        .movie-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        .poster-container {
            position: relative;
            padding-top: 150%;
        }
        .poster {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
            color: rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: color 0.3s;
        }
        .play-icon:hover {
            color: #4da8da;
        }
        .movie-info {
            padding: 10px;
        }
        .movie-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #4da8da;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            h1 {
                font-size: 36px;
            }
            .slogan {
                font-size: 16px;
            }
            #results, #trending-movies, #trending-series {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 10px;
            }
            .movie-title {
                font-size: 12px;
            }
        }
        #video-player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            backdrop-filter: blur(0px);
            transition: opacity 0.3s, backdrop-filter 0.3s;
        }
        #video-player {
            width: 80%;
            height: 80%;
            max-width: 1200px;
            max-height: 675px;
            border-radius: 15px;
            overflow: hidden;
        }
        #close-player {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: #ffffff;
            cursor: pointer;
        }
        #episode-selector {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }
        #season-select, #episode-select {
            padding: 5px 10px;
            font-size: 16px;
            background-color: #2a2a3a;
            color: #ffffff;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>streamblast</h1>
        <div class="slogan">ðŸŽ‰ no ads for movies, can't figure out tv shows yet</div>
        <form id="search-form">
            <input type="text" id="search-input" placeholder="Search for a movie or TV show...">
            <button type="submit" id="search-button">Search</button>
        </form>
        <div id="results"></div>
        <h2>Trending Movies</h2>
        <div id="trending-movies"></div>
        <h2>Trending Series</h2>
        <div id="trending-series"></div>
    </div>

    <div id="video-player-container">
        <div id="close-player">Ã—</div>
        <iframe id="video-player" frameborder="0" allowfullscreen></iframe>
        <div id="episode-selector">
            <select id="season-select"></select>
            <select id="episode-select"></select>
        </div>
    </div>

    <script>
        const omdbApiKey = 'e057c27b';
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const resultsContainer = document.getElementById('results');
        const trendingMoviesContainer = document.getElementById('trending-movies');
        const trendingSeriesContainer = document.getElementById('trending-series');
        const videoPlayerContainer = document.getElementById('video-player-container');
        const videoPlayer = document.getElementById('video-player');
        const closePlayer = document.getElementById('close-player');
        const episodeSelector = document.getElementById('episode-selector');
        const seasonSelect = document.getElementById('season-select');
        const episodeSelect = document.getElementById('episode-select');

        // Load top.json
        async function loadTopJson() {
            try {
                const response = await fetch('top.json');
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error loading top.json:', error);
                return { movies: [], series: [] };
            }
        }

        // Fetch OMDB movie details by IMDb ID
        async function fetchMovieDetails(imdbId) {
            try {
                const response = await fetch(`https://www.omdbapi.com/?apikey=${omdbApiKey}&i=${imdbId}`);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching movie details:', error);
                return null;
            }
        }

        // Fetch search results
        async function searchMovies(term) {
            try {
                const response = await fetch(`https://www.omdbapi.com/?apikey=${omdbApiKey}&s=${encodeURIComponent(term)}`);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                if (data.Response === 'False') {
                    console.error('Search error:', data.Error);
                    return [];
                }
                return data.Search || [];
            } catch (error) {
                console.error('Error searching movies:', error);
                return [];
            }
        }

        // Create movie card
        function createMovieCard(movie) {
            const movieCard = document.createElement('div');
            movieCard.className = 'movie-card';

            const posterContainer = document.createElement('div');
            posterContainer.className = 'poster-container';
            const poster = document.createElement('img');
            poster.className = 'poster';
            poster.src = movie.Poster;
            poster.alt = movie.Title;
            posterContainer.appendChild(poster);

            const playIcon = document.createElement('div');
            playIcon.className = 'play-icon';
            playIcon.innerHTML = 'â–¶';
            playIcon.onclick = () => {
                if (movie.Type === 'series') {
                    setupTvShow(movie.imdbID); // Use proper handling for series
                } else {
                    playVideo(movie.imdbID); // Use movie format URL
                }
            };

            posterContainer.appendChild(playIcon);
            movieCard.appendChild(posterContainer);

            const movieInfo = document.createElement('div');
            movieInfo.className = 'movie-info';
            const movieTitle = document.createElement('div');
            movieTitle.className = 'movie-title';
            movieTitle.textContent = movie.Title;
            movieInfo.appendChild(movieTitle);
            movieCard.appendChild(movieInfo);

            movieCard.onclick = () => {
                if (movie.Type === 'series') {
                    setupTvShow(movie.imdbID); // Use proper handling for series
                } else {
                    playVideo(movie.imdbID); // Use movie format URL
                }
            };

            return movieCard;
        }

        // Display movies by IDs
        async function displayMoviesByIds(ids, container) {
            container.innerHTML = ''; // Clear previous content
            for (const id of ids) {
                const movieDetails = await fetchMovieDetails(id);
                if (movieDetails) {
                    const movieCard = createMovieCard(movieDetails);
                    container.appendChild(movieCard);
                }
            }
        }

        // Display search results
        function displayMovies(movies) {
            resultsContainer.innerHTML = ''; // Clear previous results
            movies.forEach(movie => {
                const movieCard = createMovieCard(movie);
                resultsContainer.appendChild(movieCard);
            });
        }

        // Handle video playback
        function playVideo(imdbId, season = null, episode = null) {
            let videoUrl;
            if (season && episode) {
                videoUrl = `https://vidsrc.xyz/embed/tv?imdb=${imdbId}&season=${season}&episode=${episode}`;
            } else {
                videoUrl = `https://vidlink.pro/movie/${imdbId}`;
            }
            videoPlayer.src = videoUrl;
            videoPlayerContainer.style.display = 'flex';
            setTimeout(() => {
                videoPlayerContainer.style.opacity = '1';
                videoPlayerContainer.style.backdropFilter = 'blur(8px)';
            }, 10);
        }

        // Setup TV show
        async function setupTvShow(imdbId) {
            // Placeholder: Implement actual handling of season and episode
            episodeSelector.style.display = 'flex';

            // Example data to populate season and episode selects
            const seasons = [1, 2, 3, 4, 5];
            const episodes = Array.from({ length: 10 }, (_, i) => i + 1);

            // Populate season select
            seasonSelect.innerHTML = '<option>Select Season</option>';
            seasons.forEach(season => {
                const option = document.createElement('option');
                option.value = season;
                option.textContent = `Season ${season}`;
                seasonSelect.appendChild(option);
            });

            // Populate episode select
            episodeSelect.innerHTML = '<option>Select Episode</option>';
            episodes.forEach(episode => {
                const option = document.createElement('option');
                option.value = episode;
                option.textContent = `Episode ${episode}`;
                episodeSelect.appendChild(option);
            });

            // Set default selection
            seasonSelect.value = '1';
            episodeSelect.value = '1';

            // Event listener for season and episode changes
            seasonSelect.addEventListener('change', () => {
                const season = seasonSelect.value;
                const episode = episodeSelect.value;
                playVideo(imdbId, season, episode);
            });
            episodeSelect.addEventListener('change', () => {
                const season = seasonSelect.value;
                const episode = episodeSelect.value;
                playVideo(imdbId, season, episode);
            });

            // Temporary: Use default season and episode
            playVideo(imdbId, 1, 1);
        }

        // Close video player
        closePlayer.addEventListener('click', () => {
            videoPlayerContainer.style.opacity = '0';
            videoPlayerContainer.style.backdropFilter = 'blur(0px)';
            setTimeout(() => {
                videoPlayerContainer.style.display = 'none';
                videoPlayer.src = '';
                episodeSelector.style.display = 'none';
            }, 300);
        });

        // Initialize trending content and search
        document.addEventListener('DOMContentLoaded', async () => {
            const topJson = await loadTopJson();
            const movieIds = topJson.movies;
            const seriesIds = topJson.series;
            await displayMoviesByIds(movieIds, trendingMoviesContainer);
            await displayMoviesByIds(seriesIds, trendingSeriesContainer);
        });

        // Handle search form submission
        searchForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const searchTerm = searchInput.value.trim();
            if (searchTerm) {
                console.log('Searching for:', searchTerm); // Debug log
                const movies = await searchMovies(searchTerm);
                console.log('Search results:', movies); // Debug log
                displayMovies(movies);
            }
        });
    </script>
</body>
</html>
